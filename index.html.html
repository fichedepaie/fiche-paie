<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Appli Fiche de Paie - Gestion S√©curis√©e</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Fiche de Paie">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fiche de Paie">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Application s√©curis√©e de gestion de fiche de paie - 100% offline et priv√©e">
    
    <!-- App Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23667eea' width='100' height='100' rx='20'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>üíº</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23667eea' width='180' height='180' rx='40'/><text x='90' y='130' font-size='100' text-anchor='middle' fill='white'>üíº</text></svg>">
    
    <!-- Web App Manifest (inline) -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk1vbiBBcHBsaSBGaWNoZSBkZSBQYWllIiwKICAic2hvcnRfbmFtZSI6ICJGaWNoZSBQYWllIiwKICAiZGVzY3JpcHRpb24iOiAiR2VzdGlvbiBzw6ljdXJpc8OpZSBkZSB2b3RyZSBmaWNoZSBkZSBwYWllIC0gMTAwJSBvZmZsaW5lIiwKICAic3RhcnRfdXJsIjogIi4vaW5kZXguaHRtbCIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzY2N2VlYSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDE5MiAxOTInPjxyZWN0IGZpbGw9JyUyMzY2N2VlYScgd2lkdGg9JzE5MicgaGVpZ2h0PScxOTInIHJ4PSc0MCcvPjx0ZXh0IHg9Jzk2JyB5PScxNDAnIGZvbnQtc2l6ZT0nMTIwJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBmaWxsPSd3aGl0ZSc+8J+SvDwvdGV4dD48L3N2Zz4iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDUxMiA1MTInPjxyZWN0IGZpbGw9JyUyMzY2N2VlYScgd2lkdGg9JzUxMicgaGVpZ2h0PSc1MTInIHJ4PSc4MCcvPjx0ZXh0IHg9JzI1NicgeT0nMzgwJyBmb250LXNpemU9JzMyMCcgdGV4dC1hbmNob3I9J21pZGRsZScgZmlsbD0nd2hpdGUnPvCfkrw8L3RleHQ+PC9zdmc+IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            width: 100%;
            overflow-x: hidden;
        }

        .container {
            max-width: 450px;
            width: 100%;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                padding: 20px;
                margin: 0;
                border-radius: 0;
            }
        }

        h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            color: #555;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9em;
        }

        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .password-wrapper {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2em;
            user-select: none;
        }

        .password-strength {
            margin-top: 10px;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
        }

        .strength-bar {
            height: 100%;
            width: 0;
            transition: all 0.3s;
            border-radius: 2px;
        }

        .strength-text {
            display: block;
            margin-top: 5px;
            font-size: 0.85em;
            color: #666;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        button.secondary:hover {
            background: #f8f9ff;
        }

        .hidden {
            display: none;
        }

        .master-key-box {
            background: linear-gradient(135deg, #fff3cd 0%, #fff8e1 100%);
            padding: 25px;
            border: 2px solid #ffc107;
            border-radius: 15px;
            margin: 20px 0;
        }

        .master-key-box strong {
            color: #856404;
            font-size: 1.1em;
        }

        .master-key-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            text-align: center;
            letter-spacing: 2px;
            word-break: break-all;
            border: 2px dashed #ffc107;
        }

        .warning-text {
            color: #856404;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .error-message {
            background: #fff5f5;
            border-left: 4px solid #dc3545;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #721c24;
            font-size: 0.9em;
        }

        .success-message {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #155724;
            font-size: 0.9em;
        }

        .info-message {
            background: #e7f5ff;
            border-left: 4px solid #17a2b8;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #0c5460;
            font-size: 0.9em;
        }

        .link-button {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9em;
            padding: 0;
            margin-top: 15px;
            width: auto;
        }

        .link-button:hover {
            color: #764ba2;
            transform: none;
            box-shadow: none;
        }

        .password-requirements {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.85em;
        }

        .password-requirements ul {
            margin: 10px 0 0 20px;
            color: #666;
        }

        .password-requirements li {
            margin: 5px 0;
        }

        .requirement-met {
            color: #28a745;
        }

        .requirement-unmet {
            color: #dc3545;
        }

        .app-content {
            text-align: center;
        }

        .app-content h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .app-content p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .feature-badge {
            display: inline-block;
            background: #e7f5ff;
            color: #0c5460;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin: 5px;
        }

        .attempts-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 5px;
            color: #856404;
            font-size: 0.85em;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .screen {
            animation: fadeIn 0.4s ease-out;
        }

        /* ============================================ */
        /* STYLES DASHBOARD */
        /* ============================================ */
        
        #app-screen {
            max-width: 100%;
            padding: 0;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px 15px 0 0;
            margin: -40px -40px 20px -40px;
        }

        @media (max-width: 480px) {
            .dashboard-header {
                margin: -20px -20px 20px -20px;
                padding: 20px;
                border-radius: 0;
            }
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .header-top h2 {
            color: white;
            margin: 0;
        }

        .header-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9em;
            margin: 0;
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s;
            width: auto;
            margin: 0;
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: none;
            box-shadow: none;
        }

        /* Navigation par onglets */
        .tabs-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            color: #666;
            font-weight: 500;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
            width: auto;
            margin: 0;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            background: #f5f5f5;
            transform: none;
            box-shadow: none;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f8f9ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        /* Compteurs */
        .counters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .counter-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e7ebf7;
            transition: all 0.3s;
        }

        .counter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }

        .counter-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .counter-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .counter-label {
            color: #666;
            font-size: 0.85em;
        }

        /* Cartes de saisie */
        .input-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .input-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 0;
        }

        .info-box {
            background: #e7f5ff;
            border-left: 4px solid #17a2b8;
            padding: 12px 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 0.9em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 100%;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            width: auto;
            padding: 10px 20px;
        }

        .btn-secondary:hover {
            background: #f8f9ff;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border: none;
            width: auto;
            padding: 10px 20px;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        /* Derni√®res saisies */
        .recent-entries {
            margin-top: 25px;
        }

        .recent-entries h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .entry-item {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .entry-info {
            flex: 1;
        }

        .entry-date {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .entry-details {
            color: #666;
            font-size: 0.9em;
        }

        .entry-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.3em;
            padding: 5px;
            width: auto;
            margin: 0;
            transition: transform 0.2s;
        }

        .btn-icon:hover {
            transform: scale(1.2);
            box-shadow: none;
        }

        /* R√©capitulatif */
        .recap-header {
            margin-bottom: 25px;
        }

        .recap-header h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .date-filter {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .date-filter .input-group {
            flex: 1;
            min-width: 150px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-label {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #667eea;
        }

        .entries-table-container {
            margin-top: 30px;
        }

        .entries-table-container h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: #667eea;
            color: white;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
        }

        tbody tr:hover {
            background: #f8f9ff;
        }

        /* Param√®tres */
        .settings-section {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .settings-section h4 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info strong {
            display: block;
            color: #333;
            margin-bottom: 5px;
        }

        .setting-info p {
            color: #666;
            font-size: 0.85em;
            margin: 0;
        }

        /* Switch toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .danger-zone {
            border-color: #dc3545;
        }

        .danger-zone h4 {
            color: #dc3545;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .counters-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .date-filter {
                flex-direction: column;
                align-items: stretch;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .entry-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .tabs-nav {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .tab-btn {
                white-space: nowrap;
                font-size: 0.85em;
                padding: 10px 15px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }

            .container {
                max-width: 100%;
                padding: 20px;
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }

            h2 {
                font-size: 1.5em;
            }

            input, button, select {
                font-size: 16px;
            }

            .counters-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .counter-card {
                padding: 15px;
            }

            .counter-icon {
                font-size: 1.5em;
            }

            .counter-value {
                font-size: 1.5em;
            }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.info {
            background: #17a2b8;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-mode .container {
            background: #0f3460;
            color: #e0e0e0;
        }

        body.dark-mode h2,
        body.dark-mode h3,
        body.dark-mode h4,
        body.dark-mode .entry-date,
        body.dark-mode .setting-info strong {
            color: #e0e0e0;
        }

        body.dark-mode .subtitle,
        body.dark-mode .entry-details,
        body.dark-mode .setting-info p,
        body.dark-mode .stat-label,
        body.dark-mode .counter-label {
            color: #b0b0b0;
        }

        body.dark-mode input,
        body.dark-mode select {
            background: #1a1a2e;
            color: #e0e0e0;
            border-color: #394867;
        }

        body.dark-mode input:focus {
            border-color: #667eea;
            background: #16213e;
        }

        body.dark-mode .input-card,
        body.dark-mode .settings-section,
        body.dark-mode .stat-card,
        body.dark-mode .entry-item {
            background: #16213e;
            border-color: #394867;
        }

        body.dark-mode .counter-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-color: #394867;
        }

        body.dark-mode .tab-btn {
            color: #b0b0b0;
        }

        body.dark-mode .tab-btn:hover {
            background: #1a1a2e;
        }

        body.dark-mode .tab-btn.active {
            background: #16213e;
            color: #667eea;
        }

        body.dark-mode .tabs-nav {
            border-bottom-color: #394867;
        }

        body.dark-mode thead {
            background: #1a1a2e;
        }

        body.dark-mode table {
            background: #16213e;
        }

        body.dark-mode td {
            border-bottom-color: #394867;
            color: #e0e0e0;
        }

        body.dark-mode tbody tr:hover {
            background: #1a1a2e;
        }

        body.dark-mode .info-box {
            background: #1a3a52;
            border-left-color: #17a2b8;
            color: #b0d4e0;
        }

        body.dark-mode .danger-zone {
            border-color: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- √âCRAN DE CONFIGURATION -->
        <div id="setup-screen" class="screen hidden">
            <h2>üîí Configuration</h2>
            <p class="subtitle">Cr√©ez un mot de passe fort pour prot√©ger vos donn√©es</p>

            <div class="password-requirements">
                <strong>Votre mot de passe doit contenir :</strong>
                <ul id="password-checklist">
                    <li id="req-length" class="requirement-unmet">‚úó Au moins 8 caract√®res</li>
                    <li id="req-uppercase" class="requirement-unmet">‚úó Une lettre majuscule</li>
                    <li id="req-lowercase" class="requirement-unmet">‚úó Une lettre minuscule</li>
                    <li id="req-number" class="requirement-unmet">‚úó Un chiffre</li>
                    <li id="req-special" class="requirement-unmet">‚úó Un caract√®re sp√©cial (!@#$%^&*)</li>
                </ul>
            </div>

            <div class="input-group">
                <label for="new-password">Mot de passe</label>
                <div class="password-wrapper">
                    <input type="password" id="new-password" placeholder="Entrez votre mot de passe">
                    <span class="toggle-password" onclick="app.togglePasswordVisibility('new-password')">üëÅÔ∏è</span>
                </div>
                <div class="password-strength">
                    <div class="strength-bar" id="strength-bar"></div>
                </div>
                <span class="strength-text" id="strength-text"></span>
            </div>

            <div class="input-group">
                <label for="confirm-password">Confirmer le mot de passe</label>
                <div class="password-wrapper">
                    <input type="password" id="confirm-password" placeholder="Confirmez votre mot de passe">
                    <span class="toggle-password" onclick="app.togglePasswordVisibility('confirm-password')">üëÅÔ∏è</span>
                </div>
            </div>

            <div id="setup-error"></div>

            <button onclick="app.setupApp()">Cr√©er mon compte s√©curis√©</button>
        </div>

        <!-- √âCRAN MASTER KEY -->
        <div id="masterkey-screen" class="screen hidden">
            <h2>üîë Votre Cl√© de R√©cup√©ration</h2>
            <p class="subtitle">Conservez-la pr√©cieusement !</p>

            <div class="master-key-box">
                <strong>‚ö†Ô∏è TR√àS IMPORTANT !</strong>
                <p class="warning-text" style="margin-top: 10px;">
                    Cette cl√© de r√©cup√©ration vous permettra de retrouver l'acc√®s √† vos donn√©es si vous oubliez votre mot de passe.
                </p>
                <div class="master-key-display" id="display-masterkey"></div>
                <p class="warning-text">
                    üìù Notez-la sur papier et conservez-la dans un endroit s√ªr<br>
                    ‚ùå Ne la sauvegardez PAS sur votre t√©l√©phone ou ordinateur<br>
                    üîí Ne la partagez avec personne
                </p>
            </div>

            <button onclick="app.confirmMasterKeySaved()">‚úÖ J'ai not√© ma cl√© de r√©cup√©ration</button>
        </div>

        <!-- √âCRAN DE CONNEXION -->
        <div id="login-screen" class="screen hidden">
            <h2>üëã Bon retour !</h2>
            <p class="subtitle">Entrez votre mot de passe pour acc√©der √† vos donn√©es</p>

            <div class="input-group">
                <label for="login-password">Mot de passe</label>
                <div class="password-wrapper">
                    <input type="password" id="login-password" placeholder="Entrez votre mot de passe">
                    <span class="toggle-password" onclick="app.togglePasswordVisibility('login-password')">üëÅÔ∏è</span>
                </div>
            </div>

            <div id="login-error"></div>
            <div id="attempts-warning"></div>

            <button onclick="app.login()">Se connecter</button>
            <button class="link-button" onclick="app.showRecoveryScreen()">Mot de passe oubli√© ?</button>
        </div>

        <!-- √âCRAN DE R√âCUP√âRATION -->
        <div id="recovery-screen" class="screen hidden">
            <h2>üîì R√©cup√©ration de compte</h2>
            <p class="subtitle">Utilisez votre cl√© de r√©cup√©ration pour r√©initialiser votre mot de passe</p>

            <div class="info-message">
                üí° Entrez la cl√© de r√©cup√©ration qui vous a √©t√© fournie lors de la configuration initiale.
            </div>

            <div class="input-group">
                <label for="recovery-masterkey">Cl√© de r√©cup√©ration</label>
                <input type="text" id="recovery-masterkey" placeholder="Entrez votre cl√© de r√©cup√©ration">
            </div>

            <div id="recovery-error"></div>

            <button onclick="app.verifyMasterKey()">V√©rifier la cl√©</button>
            <button class="secondary" onclick="app.showLoginScreen()">Retour √† la connexion</button>
        </div>

        <!-- √âCRAN DE NOUVEAU MOT DE PASSE -->
        <div id="reset-password-screen" class="screen hidden">
            <h2>üîÑ Nouveau mot de passe</h2>
            <p class="subtitle">Cr√©ez un nouveau mot de passe s√©curis√©</p>

            <div class="success-message">
                ‚úÖ Cl√© de r√©cup√©ration v√©rifi√©e avec succ√®s !
            </div>

            <div class="input-group">
                <label for="reset-password">Nouveau mot de passe</label>
                <div class="password-wrapper">
                    <input type="password" id="reset-password" placeholder="Nouveau mot de passe">
                    <span class="toggle-password" onclick="app.togglePasswordVisibility('reset-password')">üëÅÔ∏è</span>
                </div>
                <div class="password-strength">
                    <div class="strength-bar" id="reset-strength-bar"></div>
                </div>
                <span class="strength-text" id="reset-strength-text"></span>
            </div>

            <div class="input-group">
                <label for="reset-confirm-password">Confirmer le mot de passe</label>
                <div class="password-wrapper">
                    <input type="password" id="reset-confirm-password" placeholder="Confirmez le mot de passe">
                    <span class="toggle-password" onclick="app.togglePasswordVisibility('reset-confirm-password')">üëÅÔ∏è</span>
                </div>
            </div>

            <div id="reset-error"></div>

            <button onclick="app.resetPassword()">R√©initialiser le mot de passe</button>
        </div>

        <!-- √âCRAN PRINCIPAL DE L'APP -->
        <div id="app-screen" class="screen hidden">
            <!-- En-t√™te de la Dashboard -->
            <div class="dashboard-header">
                <div class="header-top">
                    <h2>üìä Dashboard</h2>
                    <button class="btn-logout" onclick="app.logout()">D√©connexion</button>
                </div>
                <p class="header-subtitle">Gestion de votre fiche de paie</p>
            </div>

            <!-- Navigation par onglets -->
            <div class="tabs-nav">
                <button class="tab-btn active" onclick="app.switchTab('saisie')">üìù Saisie</button>
                <button class="tab-btn" onclick="app.switchTab('recap')">üìà R√©capitulatif</button>
                <button class="tab-btn" onclick="app.switchTab('parametres')">‚öôÔ∏è Param√®tres</button>
            </div>

            <!-- ONGLET SAISIE -->
            <div id="tab-saisie" class="tab-content active">
                <!-- Compteurs en temps r√©el -->
                <div class="counters-grid">
                    <div class="counter-card">
                        <div class="counter-icon">‚è±Ô∏è</div>
                        <div class="counter-value" id="counter-mrec">0.0</div>
                        <div class="counter-label">MREC</div>
                    </div>
                    <div class="counter-card">
                        <div class="counter-icon">üèñÔ∏è</div>
                        <div class="counter-value" id="counter-cp">25</div>
                        <div class="counter-label">CP restants</div>
                    </div>
                    <div class="counter-card">
                        <div class="counter-icon">üåô</div>
                        <div class="counter-value" id="counter-nui30">0.0</div>
                        <div class="counter-label">Heures NUI30</div>
                    </div>
                    <div class="counter-card">
                        <div class="counter-icon">üçΩÔ∏è</div>
                        <div class="counter-value" id="counter-panier">0</div>
                        <div class="counter-label">Paniers</div>
                    </div>
                    <div class="counter-card">
                        <div class="counter-icon">üé´</div>
                        <div class="counter-value" id="counter-cheques">0</div>
                        <div class="counter-label">Ch√®ques D√©jeuner</div>
                    </div>
                </div>

                <!-- Formulaire de saisie -->
                <div class="input-card">
                    <h3>üóìÔ∏è Saisir une journ√©e</h3>
                    
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="work-date">Date</label>
                            <input type="date" id="work-date">
                        </div>

                        <div class="input-group">
                            <label for="work-type">Type de journ√©e</label>
                            <select id="work-type" onchange="app.handleWorkTypeChange()">
                                <option value="travail">Travail normal</option>
                                <option value="repos">Jour de repos (MREC -7h)</option>
                                <option value="cp">Cong√© pay√© (CP -1)</option>
                                <option value="maladie">Maladie</option>
                            </select>
                        </div>
                    </div>

                    <div id="work-hours-section">
                        <div id="holiday-badge" class="hidden" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin: 15px 0; border-radius: 5px; color: #856404;">
                            <strong>üéâ Jour f√©ri√© d√©tect√© !</strong>
                            <p style="margin: 5px 0 0 0; font-size: 0.9em;">Les heures travaill√©es ce jour peuvent b√©n√©ficier d'une majoration sp√©ciale.</p>
                        </div>

                        <div class="form-grid">
                            <div class="input-group">
                                <label for="start-time">Heure d√©but</label>
                                <input type="time" id="start-time" value="08:00">
                            </div>

                            <div class="input-group">
                                <label for="end-time">Heure fin</label>
                                <input type="time" id="end-time" value="15:00">
                            </div>
                        </div>

                        <div class="info-box" id="hours-preview">
                            <strong>Aper√ßu :</strong> <span id="preview-text">7h00 de travail</span>
                        </div>
                    </div>

                    <button onclick="app.saveWorkDay()" class="btn-primary">üíæ Enregistrer la journ√©e</button>
                </div>

                <!-- Liste des derni√®res saisies -->
                <div class="recent-entries">
                    <h3>üìã Derni√®res saisies</h3>
                    <div id="recent-entries-list"></div>
                </div>
            </div>

            <!-- ONGLET R√âCAPITULATIF -->
            <div id="tab-recap" class="tab-content">
                <div class="recap-header">
                    <h3>üìà R√©capitulatif par p√©riode</h3>
                    
                    <div class="date-filter">
                        <div class="input-group">
                            <label for="filter-start">Du</label>
                            <input type="date" id="filter-start">
                        </div>
                        <div class="input-group">
                            <label for="filter-end">Au</label>
                            <input type="date" id="filter-end">
                        </div>
                        <button onclick="app.filterByDate()" class="btn-secondary">Filtrer</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total heures travaill√©es</div>
                        <div class="stat-value" id="stat-total-hours">0h00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Heures NUI30 (30%)</div>
                        <div class="stat-value" id="stat-nui30">0h00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">MREC accumul√©</div>
                        <div class="stat-value" id="stat-mrec">+0h00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">CP utilis√©s</div>
                        <div class="stat-value" id="stat-cp-used">0 jours</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Jours de maladie</div>
                        <div class="stat-value" id="stat-maladie">0 jours</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Paniers repas</div>
                        <div class="stat-value" id="stat-panier">0</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #fff3cd 0%, #fff8e1 100%); border-color: #ffc107;">
                        <div class="stat-label">üé´ Ch√®ques D√©jeuner dus</div>
                        <div class="stat-value" id="stat-cheques" style="color: #856404;">0</div>
                    </div>
                </div>

                <div class="entries-table-container">
                    <h3>üìÖ Historique d√©taill√©</h3>
                    <div id="entries-table"></div>
                </div>
            </div>

            <!-- ONGLET PARAM√àTRES -->
            <div id="tab-parametres" class="tab-content">
                <h3>‚öôÔ∏è Param√®tres de l'application</h3>

                <div class="settings-section">
                    <h4>üé® Apparence</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <strong>Mode sombre</strong>
                            <p>Interface sombre pour travailler de nuit sans fatiguer les yeux</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-dark-mode" onchange="app.toggleDarkMode()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>üîî Notifications</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <strong>Rappel hebdomadaire</strong>
                            <p>Recevoir un rappel chaque dimanche √† 20h pour faire le backup</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-notifications" onchange="app.toggleNotifications()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <strong>Alerte backup critique</strong>
                            <p>Notification urgente si aucun backup depuis 2 semaines</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-backup-alert" checked onchange="app.toggleBackupAlert()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <strong>Son & vibration</strong>
                            <p>Feedback sonore et vibration lors de la sauvegarde</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="toggle-feedback" checked onchange="app.toggleFeedback()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>üìä Soldes initiaux</h4>
                    <div class="input-group">
                        <label for="initial-cp">Solde CP initial</label>
                        <input type="number" id="initial-cp" value="25" min="0" max="50">
                    </div>
                    <div class="input-group">
                        <label for="initial-mrec">Solde MREC initial (heures)</label>
                        <input type="number" id="initial-mrec" value="0" step="0.5">
                    </div>
                    <button onclick="app.updateInitialBalances()" class="btn-secondary">üíæ Sauvegarder les soldes</button>
                </div>

                <div class="settings-section">
                    <h4>üíæ Gestion des donn√©es</h4>
                    <div style="margin-bottom: 10px; padding: 12px; background: #e7f5ff; border-radius: 8px; font-size: 0.9em;">
                        <strong>üìÖ Dernier backup:</strong> <span id="last-backup-date">Jamais</span>
                    </div>
                    <button onclick="app.exportData()" class="btn-secondary">üì• Exporter JSON (backup)</button>
                    <button onclick="app.exportPDF()" class="btn-secondary" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none;">üìÑ Exporter PDF (rapport)</button>
                    <button onclick="app.importData()" class="btn-secondary">üì§ Importer des donn√©es</button>
                    <input type="file" id="import-file-input" accept=".json" style="display: none;" onchange="app.handleFileImport(event)">
                </div>

                <div class="settings-section danger-zone">
                    <h4>‚ö†Ô∏è Zone de danger</h4>
                    <button onclick="app.resetAllData()" class="btn-danger">üóëÔ∏è R√©initialiser toutes les donn√©es</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // APPLICATION PRINCIPALE
        // ============================================
        const app = {
            // √âl√©ments DOM
            elements: {
                setupScreen: document.getElementById('setup-screen'),
                masterkeyScreen: document.getElementById('masterkey-screen'),
                loginScreen: document.getElementById('login-screen'),
                recoveryScreen: document.getElementById('recovery-screen'),
                resetPasswordScreen: document.getElementById('reset-password-screen'),
                appScreen: document.getElementById('app-screen'),
                newPassword: document.getElementById('new-password'),
                confirmPassword: document.getElementById('confirm-password'),
                loginPassword: document.getElementById('login-password'),
                displayMasterkey: document.getElementById('display-masterkey'),
                recoveryMasterkey: document.getElementById('recovery-masterkey'),
                resetPassword: document.getElementById('reset-password'),
                resetConfirmPassword: document.getElementById('reset-confirm-password')
            },

            // Configuration
            config: {
                maxLoginAttempts: 5,
                sessionTimeout: 15 * 60 * 1000, // 15 minutes
                lockoutDuration: 5 * 60 * 1000 // 5 minutes apr√®s √©chec
            },

            sessionTimer: null,
            
            // ============================================
            // INITIALISATION
            // ============================================
            init() {
                // V√©rifier si l'app est d√©j√† configur√©e
                if (!this.isConfigured()) {
                    this.showScreen('setup');
                } else {
                    // V√©rifier si le compte est verrouill√©
                    if (this.isLocked()) {
                        const unlockTime = localStorage.getItem('unlock_time');
                        const remainingTime = Math.ceil((unlockTime - Date.now()) / 1000 / 60);
                        this.showError('login-error', 
                            `üîí Compte verrouill√© suite √† trop de tentatives. R√©essayez dans ${remainingTime} minute(s).`
                        );
                    }
                    this.showScreen('login');
                }

                // Ajouter les listeners pour la force du mot de passe
                this.elements.newPassword.addEventListener('input', () => this.checkPasswordStrength('new'));
                this.elements.resetPassword.addEventListener('input', () => this.checkPasswordStrength('reset'));

                // Permettre la connexion avec Enter
                this.elements.loginPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.login();
                });
            },

            // ============================================
            // CRYPTOGRAPHIE
            // ============================================
            async hashPassword(password) {
                const encoder = new TextEncoder();
                const data = encoder.encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            },

            generateSecureMasterKey() {
                const array = new Uint8Array(16); // 128 bits
                crypto.getRandomValues(array);
                return Array.from(array)
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('')
                    .toUpperCase();
            },

            // D√©river une cl√© de chiffrement depuis le mot de passe
            async deriveEncryptionKey(password) {
                const encoder = new TextEncoder();
                const passwordData = encoder.encode(password);
                
                // Import password as key material
                const keyMaterial = await crypto.subtle.importKey(
                    'raw',
                    passwordData,
                    'PBKDF2',
                    false,
                    ['deriveBits', 'deriveKey']
                );

                // Get or generate salt
                let salt = localStorage.getItem('encryption_salt');
                if (!salt) {
                    const saltArray = new Uint8Array(16);
                    crypto.getRandomValues(saltArray);
                    salt = Array.from(saltArray).map(b => b.toString(16).padStart(2, '0')).join('');
                    localStorage.setItem('encryption_salt', salt);
                }

                const saltArray = new Uint8Array(salt.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));

                // Derive key using PBKDF2
                return await crypto.subtle.deriveKey(
                    {
                        name: 'PBKDF2',
                        salt: saltArray,
                        iterations: 100000,
                        hash: 'SHA-256'
                    },
                    keyMaterial,
                    { name: 'AES-GCM', length: 256 },
                    false,
                    ['encrypt', 'decrypt']
                );
            },

            // Chiffrer des donn√©es
            async encryptData(data, password) {
                try {
                    const key = await this.deriveEncryptionKey(password);
                    const encoder = new TextEncoder();
                    const encodedData = encoder.encode(JSON.stringify(data));

                    const iv = new Uint8Array(12);
                    crypto.getRandomValues(iv);

                    const encryptedData = await crypto.subtle.encrypt(
                        { name: 'AES-GCM', iv: iv },
                        key,
                        encodedData
                    );

                    return {
                        iv: Array.from(iv).map(b => b.toString(16).padStart(2, '0')).join(''),
                        data: Array.from(new Uint8Array(encryptedData))
                            .map(b => b.toString(16).padStart(2, '0')).join('')
                    };
                } catch (error) {
                    console.error('Encryption error:', error);
                    throw new Error('Erreur lors du chiffrement des donn√©es');
                }
            },

            // D√©chiffrer des donn√©es
            async decryptData(encryptedObj, password) {
                try {
                    const key = await this.deriveEncryptionKey(password);
                    
                    const iv = new Uint8Array(
                        encryptedObj.iv.match(/.{1,2}/g).map(byte => parseInt(byte, 16))
                    );
                    
                    const encryptedData = new Uint8Array(
                        encryptedObj.data.match(/.{1,2}/g).map(byte => parseInt(byte, 16))
                    );

                    const decryptedData = await crypto.subtle.decrypt(
                        { name: 'AES-GCM', iv: iv },
                        key,
                        encryptedData
                    );

                    const decoder = new TextDecoder();
                    return JSON.parse(decoder.decode(decryptedData));
                } catch (error) {
                    console.error('Decryption error:', error);
                    throw new Error('Erreur lors du d√©chiffrement des donn√©es');
                }
            },

            // ============================================
            // VALIDATION
            // ============================================
            validatePassword(password) {
                const requirements = {
                    length: password.length >= 8,
                    uppercase: /[A-Z]/.test(password),
                    lowercase: /[a-z]/.test(password),
                    number: /[0-9]/.test(password),
                    special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
                };

                const errors = [];
                if (!requirements.length) errors.push("Le mot de passe doit contenir au moins 8 caract√®res");
                if (!requirements.uppercase) errors.push("Le mot de passe doit contenir au moins une majuscule");
                if (!requirements.lowercase) errors.push("Le mot de passe doit contenir au moins une minuscule");
                if (!requirements.number) errors.push("Le mot de passe doit contenir au moins un chiffre");
                if (!requirements.special) errors.push("Le mot de passe doit contenir au moins un caract√®re sp√©cial");

                return {
                    isValid: errors.length === 0,
                    errors: errors,
                    requirements: requirements
                };
            },

            checkPasswordStrength(type = 'new') {
                const password = type === 'new' 
                    ? this.elements.newPassword.value 
                    : this.elements.resetPassword.value;
                    
                const barId = type === 'new' ? 'strength-bar' : 'reset-strength-bar';
                const textId = type === 'new' ? 'strength-text' : 'reset-strength-text';
                
                const bar = document.getElementById(barId);
                const text = document.getElementById(textId);

                if (password.length === 0) {
                    bar.style.width = '0';
                    text.textContent = '';
                    return;
                }

                const validation = this.validatePassword(password);
                let strength = 0;
                
                if (validation.requirements.length) strength += 20;
                if (validation.requirements.uppercase) strength += 20;
                if (validation.requirements.lowercase) strength += 20;
                if (validation.requirements.number) strength += 20;
                if (validation.requirements.special) strength += 20;

                bar.style.width = strength + '%';

                if (strength <= 40) {
                    bar.style.background = '#dc3545';
                    text.textContent = 'Faible';
                    text.style.color = '#dc3545';
                } else if (strength <= 80) {
                    bar.style.background = '#ffc107';
                    text.textContent = 'Moyen';
                    text.style.color = '#ffc107';
                } else {
                    bar.style.background = '#28a745';
                    text.textContent = 'Fort';
                    text.style.color = '#28a745';
                }

                // Mettre √† jour la checklist si on est sur l'√©cran de setup
                if (type === 'new') {
                    this.updatePasswordChecklist(validation.requirements);
                }
            },

            updatePasswordChecklist(requirements) {
                const updateRequirement = (id, met) => {
                    const elem = document.getElementById(id);
                    if (met) {
                        elem.className = 'requirement-met';
                        elem.innerHTML = elem.innerHTML.replace('‚úó', '‚úì');
                    } else {
                        elem.className = 'requirement-unmet';
                        elem.innerHTML = elem.innerHTML.replace('‚úì', '‚úó');
                    }
                };

                updateRequirement('req-length', requirements.length);
                updateRequirement('req-uppercase', requirements.uppercase);
                updateRequirement('req-lowercase', requirements.lowercase);
                updateRequirement('req-number', requirements.number);
                updateRequirement('req-special', requirements.special);
            },

            // ============================================
            // GESTION DES √âCRANS
            // ============================================
            showScreen(screenName) {
                // Masquer tous les √©crans
                Object.values(this.elements).forEach(elem => {
                    if (elem && elem.classList && elem.classList.contains('screen')) {
                        elem.classList.add('hidden');
                    }
                });

                // Afficher l'√©cran demand√©
                const screenMap = {
                    'setup': this.elements.setupScreen,
                    'masterkey': this.elements.masterkeyScreen,
                    'login': this.elements.loginScreen,
                    'recovery': this.elements.recoveryScreen,
                    'reset': this.elements.resetPasswordScreen,
                    'app': this.elements.appScreen
                };

                const screen = screenMap[screenName];
                if (screen) {
                    screen.classList.remove('hidden');
                }
            },

            // ============================================
            // GESTION DES ERREURS
            // ============================================
            showError(containerId, message) {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `<div class="error-message">${message}</div>`;
                }
            },

            clearError(containerId) {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = '';
                }
            },

            showSuccess(containerId, message) {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `<div class="success-message">${message}</div>`;
                }
            },

            // ============================================
            // CONFIGURATION INITIALE
            // ============================================
            async setupApp() {
                try {
                    this.clearError('setup-error');

                    const password = this.elements.newPassword.value;
                    const confirmPassword = this.elements.confirmPassword.value;

                    // Validation
                    const validation = this.validatePassword(password);
                    if (!validation.isValid) {
                        this.showError('setup-error', validation.errors.join('<br>'));
                        return;
                    }

                    if (password !== confirmPassword) {
                        this.showError('setup-error', "Les mots de passe ne correspondent pas");
                        return;
                    }

                    // Hacher le mot de passe
                    const hashedPassword = await this.hashPassword(password);
                    localStorage.setItem('app_password_hash', hashedPassword);

                    // G√©n√©rer et stocker la Master Key
                    const masterKey = this.generateSecureMasterKey();
                    const hashedMasterKey = await this.hashPassword(masterKey);
                    localStorage.setItem('master_key_hash', hashedMasterKey);

                    // Afficher la Master Key √† l'utilisateur
                    this.elements.displayMasterkey.textContent = masterKey;

                    // Initialiser le compteur de tentatives
                    localStorage.setItem('login_attempts', '0');

                    // Passer √† l'√©cran Master Key
                    this.showScreen('masterkey');

                } catch (error) {
                    console.error('Setup error:', error);
                    this.showError('setup-error', 'Une erreur est survenue lors de la configuration');
                }
            },

            confirmMasterKeySaved() {
                this.showScreen('login');
                this.showSuccess('login-error', '‚úÖ Configuration termin√©e ! Vous pouvez maintenant vous connecter.');
                setTimeout(() => this.clearError('login-error'), 3000);
            },

            // ============================================
            // CONNEXION
            // ============================================
            async login() {
                try {
                    this.clearError('login-error');
                    
                    // V√©rifier si le compte est verrouill√©
                    if (this.isLocked()) {
                        const unlockTime = localStorage.getItem('unlock_time');
                        const remainingTime = Math.ceil((unlockTime - Date.now()) / 1000 / 60);
                        this.showError('login-error', 
                            `üîí Compte verrouill√©. R√©essayez dans ${remainingTime} minute(s).`
                        );
                        return;
                    }

                    const password = this.elements.loginPassword.value;
                    const hashedInput = await this.hashPassword(password);
                    const storedHash = localStorage.getItem('app_password_hash');

                    if (hashedInput === storedHash) {
                        // Connexion r√©ussie
                        localStorage.setItem('login_attempts', '0');
                        this.clearError('attempts-warning');
                        
                        // Stocker le mot de passe pour chiffrement/d√©chiffrement
                        this.currentPassword = password;
                        
                        // D√©marrer la session
                        this.startSession();
                        this.showScreen('app');
                        
                        // Initialiser la dashboard
                        this.initializeDashboard();
                        
                    } else {
                        // Mot de passe incorrect
                        this.handleFailedLogin();
                    }

                } catch (error) {
                    console.error('Login error:', error);
                    this.showError('login-error', 'Une erreur est survenue lors de la connexion');
                }
            },

            handleFailedLogin() {
                let attempts = parseInt(localStorage.getItem('login_attempts') || '0');
                attempts++;
                localStorage.setItem('login_attempts', attempts.toString());

                const remaining = this.config.maxLoginAttempts - attempts;

                if (attempts >= this.config.maxLoginAttempts) {
                    // Verrouiller le compte
                    const unlockTime = Date.now() + this.config.lockoutDuration;
                    localStorage.setItem('unlock_time', unlockTime.toString());
                    this.showError('login-error', 
                        `üîí Compte verrouill√© pour 5 minutes suite √† trop de tentatives √©chou√©es.`
                    );
                } else {
                    this.showError('login-error', `‚ùå Mot de passe incorrect`);
                    
                    if (remaining <= 2) {
                        const warningDiv = document.getElementById('attempts-warning');
                        warningDiv.innerHTML = `
                            <div class="attempts-warning">
                                ‚ö†Ô∏è Attention : ${remaining} tentative(s) restante(s) avant verrouillage du compte
                            </div>
                        `;
                    }
                }

                // Vider le champ de mot de passe
                this.elements.loginPassword.value = '';
            },

            isLocked() {
                const unlockTime = localStorage.getItem('unlock_time');
                if (!unlockTime) return false;
                
                if (Date.now() < parseInt(unlockTime)) {
                    return true;
                } else {
                    // Le verrouillage est expir√©
                    localStorage.removeItem('unlock_time');
                    localStorage.setItem('login_attempts', '0');
                    return false;
                }
            },

            // ============================================
            // R√âCUP√âRATION AVEC MASTER KEY
            // ============================================
            showRecoveryScreen() {
                this.clearError('login-error');
                this.showScreen('recovery');
            },

            showLoginScreen() {
                this.clearError('recovery-error');
                this.showScreen('login');
            },

            async verifyMasterKey() {
                try {
                    this.clearError('recovery-error');

                    const inputKey = this.elements.recoveryMasterkey.value.trim().toUpperCase();
                    const hashedInput = await this.hashPassword(inputKey);
                    const storedHash = localStorage.getItem('master_key_hash');

                    if (hashedInput === storedHash) {
                        // Master Key correcte
                        this.showScreen('reset');
                    } else {
                        this.showError('recovery-error', '‚ùå Cl√© de r√©cup√©ration invalide');
                        this.elements.recoveryMasterkey.value = '';
                    }

                } catch (error) {
                    console.error('Recovery error:', error);
                    this.showError('recovery-error', 'Une erreur est survenue');
                }
            },

            async resetPassword() {
                try {
                    this.clearError('reset-error');

                    const password = this.elements.resetPassword.value;
                    const confirmPassword = this.elements.resetConfirmPassword.value;

                    // Validation
                    const validation = this.validatePassword(password);
                    if (!validation.isValid) {
                        this.showError('reset-error', validation.errors.join('<br>'));
                        return;
                    }

                    if (password !== confirmPassword) {
                        this.showError('reset-error', "Les mots de passe ne correspondent pas");
                        return;
                    }

                    // Hacher et sauvegarder le nouveau mot de passe
                    const hashedPassword = await this.hashPassword(password);
                    localStorage.setItem('app_password_hash', hashedPassword);

                    // R√©initialiser les tentatives de connexion
                    localStorage.setItem('login_attempts', '0');
                    localStorage.removeItem('unlock_time');

                    // Retour √† l'√©cran de connexion
                    this.showScreen('login');
                    this.showSuccess('login-error', 
                        '‚úÖ Mot de passe r√©initialis√© avec succ√®s ! Vous pouvez maintenant vous connecter.'
                    );
                    setTimeout(() => this.clearError('login-error'), 3000);

                } catch (error) {
                    console.error('Reset password error:', error);
                    this.showError('reset-error', 'Une erreur est survenue');
                }
            },

            // ============================================
            // GESTION DE SESSION
            // ============================================
            startSession() {
                this.resetSessionTimeout();
                
                // R√©initialiser le timeout √† chaque activit√©
                ['click', 'keypress', 'mousemove', 'touchstart'].forEach(event => {
                    document.addEventListener(event, () => this.resetSessionTimeout());
                });
            },

            resetSessionTimeout() {
                if (this.sessionTimer) {
                    clearTimeout(this.sessionTimer);
                }

                this.sessionTimer = setTimeout(() => {
                    alert('‚è±Ô∏è Session expir√©e pour votre s√©curit√©');
                    this.logout();
                }, this.config.sessionTimeout);
            },

            logout() {
                if (this.sessionTimer) {
                    clearTimeout(this.sessionTimer);
                }
                
                // Vider les champs sensibles
                this.elements.loginPassword.value = '';
                this.elements.newPassword.value = '';
                this.elements.confirmPassword.value = '';
                
                // Retour √† l'√©cran de connexion
                location.reload();
            },

            // ============================================
            // UTILITAIRES
            // ============================================
            isConfigured() {
                return localStorage.getItem('app_password_hash') !== null;
            },

            togglePasswordVisibility(inputId) {
                const input = document.getElementById(inputId);
                if (input.type === 'password') {
                    input.type = 'text';
                } else {
                    input.type = 'password';
                }
            },

            // ============================================
            // GESTION DE LA DASHBOARD
            // ============================================
            
            // Donn√©es de travail
            workData: [],
            currentPassword: null,

            // Jours f√©ri√©s fran√ßais 2026
            frenchHolidays2026: [
                '2026-01-01', // Nouvel An
                '2026-04-06', // Lundi de P√¢ques
                '2026-05-01', // F√™te du Travail
                '2026-05-08', // Victoire 1945
                '2026-05-14', // Ascension
                '2026-05-25', // Lundi de Pentec√¥te
                '2026-07-14', // F√™te Nationale
                '2026-08-15', // Assomption
                '2026-11-01', // Toussaint
                '2026-11-11', // Armistice 1918
                '2026-12-25'  // No√´l
            ],

            // Charger les donn√©es apr√®s connexion
            async loadWorkData() {
                try {
                    const encryptedData = localStorage.getItem('work_data_encrypted');
                    if (encryptedData && this.currentPassword) {
                        const decrypted = await this.decryptData(JSON.parse(encryptedData), this.currentPassword);
                        this.workData = decrypted.entries || [];
                    }
                    this.updateAllCounters();
                    this.displayRecentEntries();
                } catch (error) {
                    console.error('Erreur chargement donn√©es:', error);
                    this.workData = [];
                }
            },

            // Sauvegarder les donn√©es
            async saveWorkData() {
                try {
                    if (!this.currentPassword) return;
                    
                    const dataToSave = {
                        entries: this.workData,
                        lastUpdate: new Date().toISOString()
                    };
                    
                    const encrypted = await this.encryptData(dataToSave, this.currentPassword);
                    localStorage.setItem('work_data_encrypted', JSON.stringify(encrypted));
                    
                    this.updateAllCounters();
                    this.displayRecentEntries();
                    
                    // Feedback
                    if (this.isFeedbackEnabled()) {
                        this.playSuccessFeedback();
                    }
                    this.showToast('‚úÖ Donn√©es enregistr√©es avec succ√®s!', 'success');
                    
                } catch (error) {
                    console.error('Erreur sauvegarde:', error);
                    this.showToast('‚ùå Erreur lors de la sauvegarde', 'error');
                }
            },

            // Initialiser la date du jour
            initializeWorkDate() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('work-date').value = today;
                
                // Initialiser les dates de filtre
                const firstDayOfMonth = new Date();
                firstDayOfMonth.setDate(1);
                document.getElementById('filter-start').value = firstDayOfMonth.toISOString().split('T')[0];
                document.getElementById('filter-end').value = today;
                
                // V√©rifier si c'est un jour f√©ri√©
                this.checkHoliday(today);
                
                // Listener pour changement de date
                document.getElementById('work-date').addEventListener('change', (e) => {
                    this.checkHoliday(e.target.value);
                });
            },

            // V√©rifier si la date est un jour f√©ri√©
            checkHoliday(date) {
                const holidayBadge = document.getElementById('holiday-badge');
                if (this.frenchHolidays2026.includes(date)) {
                    holidayBadge.classList.remove('hidden');
                } else {
                    holidayBadge.classList.add('hidden');
                }
            },

            // G√©rer le changement de type de journ√©e
            handleWorkTypeChange() {
                const workType = document.getElementById('work-type').value;
                const hoursSection = document.getElementById('work-hours-section');
                
                if (workType === 'travail') {
                    hoursSection.style.display = 'block';
                    this.updateHoursPreview();
                } else {
                    hoursSection.style.display = 'none';
                }
            },

            // Mettre √† jour l'aper√ßu des heures
            updateHoursPreview() {
                const startTime = document.getElementById('start-time').value;
                const endTime = document.getElementById('end-time').value;
                const previewText = document.getElementById('preview-text');
                
                if (!startTime || !endTime) return;
                
                const start = this.timeToMinutes(startTime);
                const end = this.timeToMinutes(endTime);
                let totalMinutes = end - start;
                
                if (totalMinutes < 0) totalMinutes += 24 * 60; // Gestion nuit
                
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                
                // Calculer MREC et NUI30
                const baseHours = 7;
                const workDate = document.getElementById('work-date').value;
                const dayOfWeek = new Date(workDate).getDay();
                const isSaturday = dayOfWeek === 6;
                
                const totalHours = hours + minutes / 60;
                let mrecHours = 0;
                
                if (isSaturday) {
                    mrecHours = totalHours;
                } else if (totalHours > baseHours) {
                    mrecHours = totalHours - baseHours;
                }
                
                const nui30Hours = this.calculateNUI30Hours(startTime, endTime);
                const hasPanier = this.isNightShift(startTime, endTime);
                
                let preview = `${hours}h${minutes.toString().padStart(2, '0')} de travail`;
                if (mrecHours > 0) {
                    preview += ` ‚Ä¢ +${mrecHours.toFixed(1)}h MREC`;
                }
                if (nui30Hours > 0) {
                    preview += ` ‚Ä¢ ${nui30Hours.toFixed(1)}h NUI30`;
                }
                if (hasPanier) {
                    preview += ` ‚Ä¢ üçΩÔ∏è Panier`;
                }
                
                previewText.textContent = preview;
            },

            // Convertir heure en minutes
            timeToMinutes(time) {
                const [hours, minutes] = time.split(':').map(Number);
                return hours * 60 + minutes;
            },

            // Calculer les heures NUI30 (21h-6h)
            calculateNUI30Hours(startTime, endTime) {
                const start = this.timeToMinutes(startTime);
                const end = this.timeToMinutes(endTime);
                
                const nightStart = 21 * 60; // 21h00
                const nightEnd = 6 * 60;    // 06h00
                
                let nui30Minutes = 0;
                
                // Cas o√π le shift traverse minuit
                if (end < start) {
                    // Partie avant minuit
                    if (start < nightStart) {
                        // Pas de NUI30 avant 21h
                    } else {
                        nui30Minutes += (24 * 60) - start;
                    }
                    // Partie apr√®s minuit
                    if (end > nightEnd) {
                        nui30Minutes += nightEnd;
                    } else {
                        nui30Minutes += end;
                    }
                } else {
                    // Shift normal (m√™me jour)
                    if (start >= nightStart || end <= nightEnd) {
                        // Shift enti√®rement de nuit
                        if (start >= nightStart) {
                            nui30Minutes = Math.min(end, 24 * 60) - start;
                        } else {
                            nui30Minutes = Math.min(end, nightEnd);
                        }
                    } else if (start < nightStart && end > nightStart) {
                        // Shift commence le jour, finit la nuit
                        nui30Minutes = end - nightStart;
                    }
                }
                
                return nui30Minutes / 60;
            },

            // V√©rifier si c'est un shift de nuit (pour panier)
            isNightShift(startTime, endTime) {
                const start = this.timeToMinutes(startTime);
                const nightStart = 21 * 60; // 21h00
                const nightEnd = 6 * 60;    // 06h00
                
                // Si commence apr√®s 21h ou avant 6h = shift de nuit
                return start >= nightStart || start < nightEnd;
            },

            // Sauvegarder une journ√©e de travail
            async saveWorkDay() {
                try {
                    const date = document.getElementById('work-date').value;
                    const workType = document.getElementById('work-type').value;
                    
                    if (!date) {
                        this.showToast('‚ùå Veuillez s√©lectionner une date', 'error');
                        return;
                    }
                    
                    // V√©rifier si cette date existe d√©j√†
                    const existingIndex = this.workData.findIndex(entry => entry.date === date);
                    
                    let entry = {
                        date: date,
                        type: workType,
                        dayOfWeek: new Date(date).getDay()
                    };
                    
                    if (workType === 'travail') {
                        const startTime = document.getElementById('start-time').value;
                        const endTime = document.getElementById('end-time').value;
                        
                        if (!startTime || !endTime) {
                            this.showToast('‚ùå Veuillez saisir les heures', 'error');
                            return;
                        }
                        
                        entry.startTime = startTime;
                        entry.endTime = endTime;
                        entry.totalHours = this.calculateTotalHours(startTime, endTime);
                        entry.nui30Hours = this.calculateNUI30Hours(startTime, endTime);
                        entry.hasPanier = this.isNightShift(startTime, endTime);
                        entry.mrecHours = this.calculateMRECHours(date, entry.totalHours);
                    }
                    
                    if (existingIndex >= 0) {
                        // Mise √† jour
                        this.workData[existingIndex] = entry;
                    } else {
                        // Nouveau
                        this.workData.push(entry);
                    }
                    
                    // Trier par date d√©croissante
                    this.workData.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    await this.saveWorkData();
                    
                } catch (error) {
                    console.error('Erreur sauvegarde journ√©e:', error);
                    this.showToast('‚ùå Erreur lors de la sauvegarde', 'error');
                }
            },

            // Calculer le total d'heures
            calculateTotalHours(startTime, endTime) {
                const start = this.timeToMinutes(startTime);
                const end = this.timeToMinutes(endTime);
                let totalMinutes = end - start;
                
                if (totalMinutes < 0) totalMinutes += 24 * 60;
                
                return totalMinutes / 60;
            },

            // Calculer les heures MREC
            calculateMRECHours(date, totalHours) {
                const dayOfWeek = new Date(date).getDay();
                const isSaturday = dayOfWeek === 6;
                const baseHours = 7;
                
                if (isSaturday) {
                    return totalHours; // Tout le samedi en MREC
                } else if (totalHours > baseHours) {
                    return totalHours - baseHours; // Heures sup en MREC
                } else {
                    return 0;
                }
            },

            // Mettre √† jour tous les compteurs
            updateAllCounters() {
                let totalMREC = parseFloat(localStorage.getItem('initial_mrec') || '0');
                let totalNUI30 = 0;
                let totalPanier = 0;
                let cpUsed = 0;
                let workDays = 0;
                
                this.workData.forEach(entry => {
                    if (entry.type === 'travail') {
                        totalMREC += entry.mrecHours || 0;
                        totalNUI30 += entry.nui30Hours || 0;
                        if (entry.hasPanier) totalPanier++;
                        workDays++;
                    } else if (entry.type === 'repos') {
                        totalMREC -= 7; // Repos = -7h MREC
                    } else if (entry.type === 'cp') {
                        cpUsed++;
                    }
                });
                
                // Calcul Ch√®ques D√©jeuner
                // Jours travaill√©s - CP - Maladie - Jours avec Panier
                const maladieCount = this.workData.filter(e => e.type === 'maladie').length;
                const chequesDejeune = Math.max(0, workDays - totalPanier);
                
                const initialCP = parseInt(localStorage.getItem('initial_cp') || '25');
                const remainingCP = initialCP - cpUsed;
                
                document.getElementById('counter-mrec').textContent = totalMREC.toFixed(1);
                document.getElementById('counter-cp').textContent = remainingCP;
                document.getElementById('counter-nui30').textContent = totalNUI30.toFixed(1);
                document.getElementById('counter-panier').textContent = totalPanier;
                document.getElementById('counter-cheques').textContent = chequesDejeune;
            },

            // Afficher les derni√®res saisies
            displayRecentEntries() {
                const container = document.getElementById('recent-entries-list');
                const recent = this.workData.slice(0, 5);
                
                if (recent.length === 0) {
                    container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">Aucune saisie pour le moment</p>';
                    return;
                }
                
                container.innerHTML = recent.map(entry => {
                    const dateObj = new Date(entry.date);
                    const dateFormatted = dateObj.toLocaleDateString('fr-FR', { 
                        weekday: 'short', 
                        day: '2-digit', 
                        month: '2-digit' 
                    });
                    
                    let details = '';
                    if (entry.type === 'travail') {
                        details = `${entry.startTime} - ${entry.endTime} ‚Ä¢ ${entry.totalHours.toFixed(1)}h`;
                        if (entry.mrecHours > 0) details += ` ‚Ä¢ +${entry.mrecHours.toFixed(1)}h MREC`;
                        if (entry.nui30Hours > 0) details += ` ‚Ä¢ ${entry.nui30Hours.toFixed(1)}h NUI30`;
                        if (entry.hasPanier) details += ` üçΩÔ∏è`;
                    } else if (entry.type === 'repos') {
                        details = 'Jour de repos (-7h MREC)';
                    } else if (entry.type === 'cp') {
                        details = 'Cong√© pay√© (-1 CP)';
                    } else if (entry.type === 'maladie') {
                        details = 'Maladie';
                    }
                    
                    return `
                        <div class="entry-item">
                            <div class="entry-info">
                                <div class="entry-date">${dateFormatted}</div>
                                <div class="entry-details">${details}</div>
                            </div>
                            <div class="entry-actions">
                                <button class="btn-icon" onclick="app.editEntry('${entry.date}')" title="Modifier">‚úèÔ∏è</button>
                                <button class="btn-icon" onclick="app.deleteEntry('${entry.date}')" title="Supprimer">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            // Modifier une entr√©e
            editEntry(date) {
                const entry = this.workData.find(e => e.date === date);
                if (!entry) return;
                
                // Remplir le formulaire
                document.getElementById('work-date').value = date;
                document.getElementById('work-type').value = entry.type;
                
                if (entry.type === 'travail') {
                    document.getElementById('start-time').value = entry.startTime;
                    document.getElementById('end-time').value = entry.endTime;
                }
                
                this.handleWorkTypeChange();
                this.updateHoursPreview();
                
                // Scroller vers le formulaire
                this.switchTab('saisie');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                this.showToast('‚úèÔ∏è Modification de la journ√©e du ' + new Date(date).toLocaleDateString('fr-FR'), 'info');
            },

            // Supprimer une entr√©e
            async deleteEntry(date) {
                if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette entr√©e ?')) return;
                
                this.workData = this.workData.filter(e => e.date !== date);
                await this.saveWorkData();
                
                this.showToast('üóëÔ∏è Entr√©e supprim√©e', 'success');
            },

            // Basculer entre les onglets
            switchTab(tabName) {
                // Masquer tous les onglets
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Afficher l'onglet s√©lectionn√©
                document.getElementById('tab-' + tabName).classList.add('active');
                event.target.classList.add('active');
                
                // Mettre √† jour le r√©capitulatif si on y va
                if (tabName === 'recap') {
                    this.updateRecapStats();
                }
            },

            // Filtrer par p√©riode
            filterByDate() {
                this.updateRecapStats();
            },

            // Mettre √† jour les stats du r√©capitulatif
            updateRecapStats() {
                const startDate = document.getElementById('filter-start').value;
                const endDate = document.getElementById('filter-end').value;
                
                if (!startDate || !endDate) {
                    this.showToast('‚ùå Veuillez s√©lectionner une p√©riode', 'error');
                    return;
                }
                
                // Filtrer les donn√©es
                const filteredData = this.workData.filter(entry => {
                    return entry.date >= startDate && entry.date <= endDate;
                });
                
                // Calculer les statistiques
                let totalHours = 0;
                let totalNUI30 = 0;
                let totalMREC = 0;
                let cpUsed = 0;
                let maladieCount = 0;
                let panierCount = 0;
                let workDays = 0;
                
                filteredData.forEach(entry => {
                    if (entry.type === 'travail') {
                        totalHours += entry.totalHours || 0;
                        totalNUI30 += entry.nui30Hours || 0;
                        totalMREC += entry.mrecHours || 0;
                        if (entry.hasPanier) panierCount++;
                        workDays++;
                    } else if (entry.type === 'repos') {
                        totalMREC -= 7;
                    } else if (entry.type === 'cp') {
                        cpUsed++;
                    } else if (entry.type === 'maladie') {
                        maladieCount++;
                    }
                });
                
                // Calcul Ch√®ques D√©jeuner
                const chequesDejeune = Math.max(0, workDays - panierCount);
                
                // Afficher les stats
                document.getElementById('stat-total-hours').textContent = this.formatHours(totalHours);
                document.getElementById('stat-nui30').textContent = this.formatHours(totalNUI30);
                document.getElementById('stat-mrec').textContent = (totalMREC >= 0 ? '+' : '') + this.formatHours(totalMREC);
                document.getElementById('stat-cp-used').textContent = cpUsed + ' jour' + (cpUsed > 1 ? 's' : '');
                document.getElementById('stat-maladie').textContent = maladieCount + ' jour' + (maladieCount > 1 ? 's' : '');
                document.getElementById('stat-panier').textContent = panierCount;
                document.getElementById('stat-cheques').textContent = chequesDejeune;
                
                // Afficher le tableau
                this.displayEntriesTable(filteredData);
            },

            // Formater les heures
            formatHours(hours) {
                const h = Math.floor(Math.abs(hours));
                const m = Math.round((Math.abs(hours) - h) * 60);
                const sign = hours < 0 ? '-' : '';
                return `${sign}${h}h${m.toString().padStart(2, '0')}`;
            },

            // Afficher le tableau des entr√©es
            displayEntriesTable(data) {
                const container = document.getElementById('entries-table');
                
                if (data.length === 0) {
                    container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">Aucune donn√©e pour cette p√©riode</p>';
                    return;
                }
                
                const sortedData = [...data].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                container.innerHTML = `
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Heures</th>
                                    <th>MREC</th>
                                    <th>NUI30</th>
                                    <th>Panier</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sortedData.map(entry => {
                                    const dateFormatted = new Date(entry.date).toLocaleDateString('fr-FR');
                                    let typeLabel = '';
                                    if (entry.type === 'travail') typeLabel = 'üíº Travail';
                                    else if (entry.type === 'repos') typeLabel = 'üè† Repos';
                                    else if (entry.type === 'cp') typeLabel = 'üèñÔ∏è CP';
                                    else if (entry.type === 'maladie') typeLabel = 'ü§í Maladie';
                                    
                                    return `
                                        <tr>
                                            <td>${dateFormatted}</td>
                                            <td>${typeLabel}</td>
                                            <td>${entry.totalHours ? this.formatHours(entry.totalHours) : '-'}</td>
                                            <td>${entry.mrecHours ? (entry.mrecHours > 0 ? '+' : '') + this.formatHours(entry.mrecHours) : (entry.type === 'repos' ? '-7h00' : '-')}</td>
                                            <td>${entry.nui30Hours ? this.formatHours(entry.nui30Hours) : '-'}</td>
                                            <td>${entry.hasPanier ? 'üçΩÔ∏è' : '-'}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            },

            // Notifications
            toggleNotifications() {
                const enabled = document.getElementById('toggle-notifications').checked;
                localStorage.setItem('notifications_enabled', enabled);
                
                if (enabled) {
                    this.requestNotificationPermission();
                    this.scheduleNotification();
                    this.showToast('üîî Notifications activ√©es', 'success');
                } else {
                    this.showToast('üîï Notifications d√©sactiv√©es', 'info');
                }
            },

            async requestNotificationPermission() {
                if ('Notification' in window && Notification.permission === 'default') {
                    await Notification.requestPermission();
                }
            },

            scheduleNotification() {
                // Planifier notification HEBDOMADAIRE (dimanche √† 20h)
                const now = new Date();
                const scheduledTime = new Date();
                
                // Trouver le prochain dimanche
                const daysUntilSunday = (7 - now.getDay()) % 7;
                scheduledTime.setDate(now.getDate() + (daysUntilSunday === 0 ? 7 : daysUntilSunday));
                scheduledTime.setHours(20, 0, 0, 0);
                
                // Si c'est d√©j√† dimanche apr√®s 20h, programmer pour dimanche prochain
                if (now.getDay() === 0 && now.getHours() >= 20) {
                    scheduledTime.setDate(scheduledTime.getDate() + 7);
                }
                
                const timeUntil = scheduledTime - now;
                
                setTimeout(() => {
                    if (this.isNotificationsEnabled() && Notification.permission === 'granted') {
                        new Notification('üíæ Backup hebdomadaire recommand√©', {
                            body: 'C\'est dimanche soir ! Pensez √† faire votre backup hebdomadaire (30 secondes)',
                            icon: 'üíæ',
                            requireInteraction: true
                        });
                    }
                    
                    // V√©rifier aussi si backup critique n√©cessaire
                    this.checkBackupAlert();
                    
                    // Replanifier pour dimanche prochain
                    this.scheduleNotification();
                }, timeUntil);
                
                console.log(`Prochaine notification de backup: ${scheduledTime.toLocaleString('fr-FR')}`);
            },

            isNotificationsEnabled() {
                return localStorage.getItem('notifications_enabled') === 'true';
            },

            toggleFeedback() {
                const enabled = document.getElementById('toggle-feedback').checked;
                localStorage.setItem('feedback_enabled', enabled);
                
                if (enabled) {
                    this.playSuccessFeedback();
                    this.showToast('üîä Feedback activ√©', 'success');
                } else {
                    this.showToast('üîá Feedback d√©sactiv√©', 'info');
                }
            },

            isFeedbackEnabled() {
                return localStorage.getItem('feedback_enabled') !== 'false'; // Activ√© par d√©faut
            },

            playSuccessFeedback() {
                // Son
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
                
                // Vibration
                if ('vibrate' in navigator) {
                    navigator.vibrate(100);
                }
            },

            // Mettre √† jour les soldes initiaux
            updateInitialBalances() {
                const cp = document.getElementById('initial-cp').value;
                const mrec = document.getElementById('initial-mrec').value;
                
                localStorage.setItem('initial_cp', cp);
                localStorage.setItem('initial_mrec', mrec);
                
                this.updateAllCounters();
                this.showToast('‚úÖ Soldes initiaux mis √† jour', 'success');
            },

            // Exporter les donn√©es
            exportData() {
                const dataToExport = {
                    workData: this.workData,
                    initialCP: localStorage.getItem('initial_cp'),
                    initialMREC: localStorage.getItem('initial_mrec'),
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fiche-paie-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                // Enregistrer la date du dernier backup
                localStorage.setItem('last_backup_date', new Date().toISOString());
                this.updateLastBackupDisplay();
                
                // Cr√©er backup quotidien automatique
                this.createDailyBackup(dataToExport);
                
                this.showToast('üì• Backup enregistr√© avec succ√®s!', 'success');
            },

            // Cr√©er backup automatique quotidien (7 jours rotatifs)
            createDailyBackup(data) {
                const dayOfWeek = new Date().getDay(); // 0-6 (dimanche-samedi)
                const backupKey = `daily_backup_day_${dayOfWeek}`;
                
                try {
                    localStorage.setItem(backupKey, JSON.stringify({
                        data: data,
                        date: new Date().toISOString()
                    }));
                } catch (error) {
                    console.error('Erreur backup quotidien:', error);
                }
            },

            // Restaurer depuis backup quotidien si n√©cessaire
            restoreFromDailyBackup() {
                // Essayer de r√©cup√©rer le backup le plus r√©cent
                let mostRecentBackup = null;
                let mostRecentDate = null;
                
                for (let i = 0; i < 7; i++) {
                    const backupKey = `daily_backup_day_${i}`;
                    const backup = localStorage.getItem(backupKey);
                    
                    if (backup) {
                        try {
                            const parsed = JSON.parse(backup);
                            const backupDate = new Date(parsed.date);
                            
                            if (!mostRecentDate || backupDate > mostRecentDate) {
                                mostRecentDate = backupDate;
                                mostRecentBackup = parsed.data;
                            }
                        } catch (e) {
                            console.error('Erreur lecture backup:', e);
                        }
                    }
                }
                
                return mostRecentBackup;
            },

            // Exporter PDF
            exportPDF() {
                const startDate = document.getElementById('filter-start').value;
                const endDate = document.getElementById('filter-end').value;
                
                if (!startDate || !endDate) {
                    this.showToast('‚ùå S√©lectionnez une p√©riode dans l\'onglet R√©capitulatif', 'error');
                    this.switchTab('recap');
                    return;
                }
                
                // Filtrer les donn√©es
                const filteredData = this.workData.filter(entry => {
                    return entry.date >= startDate && entry.date <= endDate;
                }).sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Calculer les statistiques
                let totalHours = 0, totalNUI30 = 0, totalMREC = 0;
                let cpUsed = 0, maladieCount = 0, panierCount = 0, workDays = 0;
                
                filteredData.forEach(entry => {
                    if (entry.type === 'travail') {
                        totalHours += entry.totalHours || 0;
                        totalNUI30 += entry.nui30Hours || 0;
                        totalMREC += entry.mrecHours || 0;
                        if (entry.hasPanier) panierCount++;
                        workDays++;
                    } else if (entry.type === 'repos') {
                        totalMREC -= 7;
                    } else if (entry.type === 'cp') {
                        cpUsed++;
                    } else if (entry.type === 'maladie') {
                        maladieCount++;
                    }
                });
                
                const chequesDejeune = Math.max(0, workDays - panierCount);
                
                // G√©n√©rer HTML pour PDF
                const htmlContent = `
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Rapport Fiche de Paie</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; color: #333; }
        h1 { color: #667eea; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        h2 { color: #555; margin-top: 30px; }
        .period { background: #f8f9ff; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
        .stat-box { background: #f8f9ff; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; }
        .stat-label { font-size: 0.9em; color: #666; margin-bottom: 5px; }
        .stat-value { font-size: 1.5em; font-weight: bold; color: #667eea; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #667eea; color: white; padding: 12px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #e0e0e0; }
        tr:hover { background: #f8f9ff; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #e0e0e0; font-size: 0.9em; color: #666; }
        .highlight { background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>üìä Rapport Fiche de Paie</h1>
    
    <div class="period">
        <strong>P√©riode :</strong> ${new Date(startDate).toLocaleDateString('fr-FR')} au ${new Date(endDate).toLocaleDateString('fr-FR')}
        <br>
        <strong>G√©n√©r√© le :</strong> ${new Date().toLocaleDateString('fr-FR')} √† ${new Date().toLocaleTimeString('fr-FR')}
    </div>
    
    <h2>üìà R√©capitulatif</h2>
    <div class="stats">
        <div class="stat-box">
            <div class="stat-label">Heures travaill√©es</div>
            <div class="stat-value">${this.formatHours(totalHours)}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Heures NUI30 (30%)</div>
            <div class="stat-value">${this.formatHours(totalNUI30)}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">MREC</div>
            <div class="stat-value">${(totalMREC >= 0 ? '+' : '')}${this.formatHours(totalMREC)}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">CP utilis√©s</div>
            <div class="stat-value">${cpUsed}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Jours maladie</div>
            <div class="stat-value">${maladieCount}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Paniers repas</div>
            <div class="stat-value">${panierCount}</div>
        </div>
    </div>
    
    <div class="highlight">
        <strong>üé´ Ch√®ques D√©jeuner dus :</strong> ${chequesDejeune}
        <br><small>Calcul : ${workDays} jours travaill√©s - ${panierCount} paniers repas</small>
    </div>
    
    <h2>üìÖ D√©tail des journ√©es</h2>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Heures</th>
                <th>MREC</th>
                <th>NUI30</th>
                <th>Panier</th>
            </tr>
        </thead>
        <tbody>
            ${filteredData.map(entry => {
                const dateFormatted = new Date(entry.date).toLocaleDateString('fr-FR');
                const isFerie = this.frenchHolidays2026.includes(entry.date);
                let typeLabel = '';
                if (entry.type === 'travail') typeLabel = 'üíº Travail' + (isFerie ? ' üéâ' : '');
                else if (entry.type === 'repos') typeLabel = 'üè† Repos';
                else if (entry.type === 'cp') typeLabel = 'üèñÔ∏è CP';
                else if (entry.type === 'maladie') typeLabel = 'ü§í Maladie';
                
                return `
                    <tr>
                        <td>${dateFormatted}</td>
                        <td>${typeLabel}</td>
                        <td>${entry.totalHours ? this.formatHours(entry.totalHours) : '-'}</td>
                        <td>${entry.mrecHours ? (entry.mrecHours > 0 ? '+' : '') + this.formatHours(entry.mrecHours) : (entry.type === 'repos' ? '-7h00' : '-')}</td>
                        <td>${entry.nui30Hours ? this.formatHours(entry.nui30Hours) : '-'}</td>
                        <td>${entry.hasPanier ? 'üçΩÔ∏è' : '-'}</td>
                    </tr>
                `;
            }).join('')}
        </tbody>
    </table>
    
    <div class="footer">
        <p>üì± G√©n√©r√© par Mon Appli Fiche de Paie - Application s√©curis√©e de gestion de paie</p>
        <p><em>Ce document est g√©n√©r√© automatiquement √† partir de vos donn√©es personnelles crypt√©es.</em></p>
    </div>
</body>
</html>
                `;
                
                // Cr√©er et t√©l√©charger le PDF (en HTML)
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `rapport-fiche-paie-${startDate}-au-${endDate}.html`;
                a.click();
                
                this.showToast('üìÑ Rapport PDF g√©n√©r√©! Ouvrez-le et imprimez en PDF', 'success');
            },

            // Dark Mode
            toggleDarkMode() {
                const enabled = document.getElementById('toggle-dark-mode').checked;
                document.body.classList.toggle('dark-mode', enabled);
                localStorage.setItem('dark_mode', enabled);
                
                this.showToast(enabled ? 'üåô Mode sombre activ√©' : '‚òÄÔ∏è Mode clair activ√©', 'success');
            },

            // Mettre √† jour l'affichage du dernier backup
            updateLastBackupDisplay() {
                const lastBackup = localStorage.getItem('last_backup_date');
                const displayElem = document.getElementById('last-backup-date');
                
                if (lastBackup) {
                    const date = new Date(lastBackup);
                    displayElem.textContent = date.toLocaleDateString('fr-FR') + ' √† ' + date.toLocaleTimeString('fr-FR');
                } else {
                    displayElem.textContent = 'Jamais';
                }
            },

            // Toggle backup alert
            toggleBackupAlert() {
                const enabled = document.getElementById('toggle-backup-alert').checked;
                localStorage.setItem('backup_alert_enabled', enabled);
                
                if (enabled) {
                    this.checkBackupAlert();
                    this.showToast('üîî Alerte backup critique activ√©e', 'success');
                } else {
                    this.showToast('üîï Alerte backup critique d√©sactiv√©e', 'info');
                }
            },

            // V√©rifier si backup critique n√©cessaire
            checkBackupAlert() {
                if (localStorage.getItem('backup_alert_enabled') !== 'true') return;
                
                const lastBackup = localStorage.getItem('last_backup_date');
                if (!lastBackup) return;
                
                const daysSinceBackup = (Date.now() - new Date(lastBackup)) / (1000 * 60 * 60 * 24);
                
                if (daysSinceBackup >= 14) {
                    // Alerte critique
                    if (Notification.permission === 'granted') {
                        new Notification('‚ö†Ô∏è BACKUP CRITIQUE REQUIS !', {
                            body: `Aucun backup depuis ${Math.floor(daysSinceBackup)} jours ! Risque de perte de donn√©es.`,
                            icon: '‚ö†Ô∏è',
                            requireInteraction: true
                        });
                    }
                    this.showToast(`‚ö†Ô∏è ATTENTION: Dernier backup il y a ${Math.floor(daysSinceBackup)} jours!`, 'error');
                }
            },

            // Importer les donn√©es
            importData() {
                document.getElementById('import-file-input').click();
            },

            async handleFileImport(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const importedData = JSON.parse(text);
                    
                    if (!importedData.workData) {
                        throw new Error('Format de fichier invalide');
                    }
                    
                    if (confirm('Cette action remplacera toutes vos donn√©es actuelles. Continuer ?')) {
                        this.workData = importedData.workData;
                        if (importedData.initialCP) localStorage.setItem('initial_cp', importedData.initialCP);
                        if (importedData.initialMREC) localStorage.setItem('initial_mrec', importedData.initialMREC);
                        
                        await this.saveWorkData();
                        
                        // Mettre √† jour l'interface
                        document.getElementById('initial-cp').value = importedData.initialCP || 25;
                        document.getElementById('initial-mrec').value = importedData.initialMREC || 0;
                        
                        this.showToast('üì§ Donn√©es import√©es avec succ√®s', 'success');
                    }
                } catch (error) {
                    console.error('Erreur import:', error);
                    this.showToast('‚ùå Erreur lors de l\'importation', 'error');
                }
                
                // Reset input
                event.target.value = '';
            },

            // R√©initialiser toutes les donn√©es
            async resetAllData() {
                if (!confirm('‚ö†Ô∏è ATTENTION ! Cette action supprimera toutes vos donn√©es de travail. Cette action est irr√©versible. Continuer ?')) {
                    return;
                }
                
                if (!confirm('√ätes-vous vraiment s√ªr ? Toutes les saisies seront perdues !')) {
                    return;
                }
                
                this.workData = [];
                await this.saveWorkData();
                
                localStorage.setItem('initial_cp', '25');
                localStorage.setItem('initial_mrec', '0');
                
                document.getElementById('initial-cp').value = 25;
                document.getElementById('initial-mrec').value = 0;
                
                this.showToast('üóëÔ∏è Toutes les donn√©es ont √©t√© r√©initialis√©es', 'success');
            },

            // Toast notification
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 3000);
            },

            // Initialiser la dashboard apr√®s connexion
            initializeDashboard() {
                this.initializeWorkDate();
                this.loadWorkData();
                
                // Charger les pr√©f√©rences
                const notifEnabled = this.isNotificationsEnabled();
                document.getElementById('toggle-notifications').checked = notifEnabled;
                
                const feedbackEnabled = this.isFeedbackEnabled();
                document.getElementById('toggle-feedback').checked = feedbackEnabled;
                
                const backupAlertEnabled = localStorage.getItem('backup_alert_enabled') !== 'false';
                document.getElementById('toggle-backup-alert').checked = backupAlertEnabled;
                
                // Charger Dark Mode
                const darkModeEnabled = localStorage.getItem('dark_mode') === 'true';
                document.getElementById('toggle-dark-mode').checked = darkModeEnabled;
                if (darkModeEnabled) {
                    document.body.classList.add('dark-mode');
                }
                
                // Charger les soldes initiaux
                document.getElementById('initial-cp').value = localStorage.getItem('initial_cp') || 25;
                document.getElementById('initial-mrec').value = localStorage.getItem('initial_mrec') || 0;
                
                // Afficher date dernier backup
                this.updateLastBackupDisplay();
                
                // Listeners
                document.getElementById('start-time').addEventListener('input', () => this.updateHoursPreview());
                document.getElementById('end-time').addEventListener('input', () => this.updateHoursPreview());
                
                // Planifier notifications si activ√©es
                if (notifEnabled) {
                    this.scheduleNotification();
                }
                
                // V√©rifier si backup critique n√©cessaire
                if (backupAlertEnabled) {
                    this.checkBackupAlert();
                }
            },

            // Installer la PWA
            installPWA() {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('PWA install√©e');
                        }
                        deferredPrompt = null;
                    });
                }
            }
        };

        // ============================================
        // INITIALISER L'APPLICATION
        // ============================================
        
        // D√©tecter si l'app est en mode standalone (install√©e)
        let deferredPrompt;
        
        // G√©rer l'√©v√©nement d'installation PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Afficher un message pour installer l'app
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                setTimeout(() => {
                    const installBanner = document.createElement('div');
                    installBanner.style.cssText = `
                        position: fixed;
                        bottom: 20px;
                        left: 20px;
                        right: 20px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 15px 20px;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                        z-index: 10000;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        gap: 15px;
                        animation: slideIn 0.3s ease-out;
                    `;
                    
                    installBanner.innerHTML = `
                        <div style="flex: 1;">
                            <strong>üì± Installer l'application</strong>
                            <p style="margin: 5px 0 0 0; font-size: 0.85em; opacity: 0.9;">
                                Ajoutez √† l'√©cran d'accueil pour un acc√®s rapide
                            </p>
                        </div>
                        <button onclick="app.installPWA()" style="
                            background: white;
                            color: #667eea;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                        ">Installer</button>
                        <button onclick="this.parentElement.remove()" style="
                            background: rgba(255,255,255,0.2);
                            color: white;
                            border: none;
                            padding: 10px 15px;
                            border-radius: 8px;
                            cursor: pointer;
                        ">‚úï</button>
                    `;
                    
                    document.body.appendChild(installBanner);
                }, 3000);
            }
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // Test localStorage
                if (typeof(Storage) === "undefined") {
                    alert("‚ö†Ô∏è Votre navigateur ne supporte pas le stockage local. L'app ne peut pas fonctionner.");
                    document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h2>‚ùå Navigateur non compatible</h2><p>Veuillez utiliser Chrome, Safari ou Firefox r√©cent.</p></div>';
                    return;
                }
                
                // Test si on peut √©crire dans localStorage
                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                } catch (e) {
                    alert("‚ö†Ô∏è Le stockage local est bloqu√©. D√©sactivez le mode priv√©/incognito.");
                    document.body.innerHTML = '<div style="padding: 20px; text-align: center; background: white; color: #333;"><h2>‚ö†Ô∏è Mode priv√© d√©tect√©</h2><p>L\'application ne peut pas fonctionner en mode navigation priv√©e.</p><p><strong>D√©sactivez le mode incognito et rechargez.</strong></p></div>';
                    return;
                }
                
                app.init();
            } catch (error) {
                console.error('Erreur critique:', error);
                alert('‚ùå Erreur: ' + error.message);
                document.body.innerHTML = `
                    <div style="padding: 20px; background: white; color: #333;">
                        <h2>‚ùå Erreur de chargement</h2>
                        <p><strong>D√©tails:</strong> ${error.message}</p>
                        <p>Essayez de:</p>
                        <ul>
                            <li>Recharger la page</li>
                            <li>Vider le cache</li>
                            <li>Utiliser un autre navigateur</li>
                        </ul>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>